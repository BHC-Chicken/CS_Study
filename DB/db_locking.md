# DB Locking

## Lock

* `Lock`이란 **트랜잭션 처리의 순차성**을 보장하기 위한 방법이다.

  Locking 기법은 병행 수행되는 트랜잭션들이 동일한 데이터에 동시에 접근하지 못하도록 lock과 unlock이라는 2개의 연산을 이용해 제어한다.

  기본 원리는 한 트랜잭션이 먼저 접근한 데이터에 대한 연산을 모두 마칠 때까지, 다른 트랜잭션이 접근하지 못하도록 상호 배제하여 직렬 가능성을 보장하는 것이다.

  `lock` 연산은 트랜잭션이 사용할 데이터에 대한 **독점권**을 가지기 위해 사용한다.

  `unlock` 연산은 트랜잭션이 데이터에 대한 **독점권을 반납**하기 위해 사용한다.

> Locking 기법에서 모든 트랜잭션이 지켜야 하는 **기본 Locking 규약**을 알아보자.

1. Locking 기법을 사용해 트랜잭션이 **DB에 있는 데이터에 접근하는 연산을 실행**하려면, 먼저 해당 데이터에 lock 연산을 실행하여 **독점권을 획득**해야 한다.

2. 트랜잭션이 lock 연산을 통해 독점권을 획득한 데이터에 대한 **모든 연산을 수행하고 나면** unlock 연산을 실행해서 **독점권을 반납**해야 한다. 그래야 다른 트랜잭션이 해당 데이터에 접근할 수 있기 때문이다.

3. 데이터에 **lock 연산을 실행한** 트랜잭션만 해당 데이터에 unlock 연산을 실행할 수 있다. 즉, 데이터에 대한 독점권을 부여받은 트랜잭션만 해당 데이터에 대한 독점권을 반납할 수 있다.

## Lock 단위 설정

* lock 연산은 크게 전체 DB부터 DB를 구성하는 속성에 이르기까지 다양한 크기의 데이터를 대상으로 실행할 수 있다. (ex. 릴레이션, 튜플)

* **전체 DB**에 lock 연산을 실행하면 제어가 간단하다는 장점이 있지만 DB에 하나의 트랜잭션만 수행하므로 병행 수행이라 할 수 없다.

  반면, **가장 적은 단위**의 속성에 lock 연산을 실행하면 독점하는 범위가 좁아 많은 수의 트랜잭션을 병행 수행할 수 있다는 장점이 있지만, 제어가 복잡하다는 단점이 있다.

  즉, Locking 단위가 커질수록 병행성은 낮아지지만 제어는 쉽고, 

  Locking 단위가 작아질수록 제어는 어렵지만 병행성은 높아진다.

  그러므로 시스템에 따라 적절한 Locking 단위를 선택하는 것이 중요하다.

## Lock 연산 종류

* Shared Lock(공유 잠금) : 해당 데이터에 read 연산만(write 연산은 실행X) 실행할 수 있다. 그리고 해당 데이터에 대한 다른 트랜잭션도 shared lock 연산을 동시에 실행할 수 있다.(동시에 접근이 가능하다)

* Exclusive Lock(배타 잠금) : 해당 데이터에 read 연산과 write 연산을 모두 실행할 수 있다. 하지만 lock이 해제될 때까지 해당 데이터에 다른 트랜잭션이 어떤 lock 연산도 실행할 수 없다(접근 불가능)


## 예상 질문

* Locking 단위 설정에 대한 장점과 단점이 무엇인가요?

* Lock 연산 종류 2가지에 대해 설명해 주세요.

## Reference

* [데이터베이스 개론](https://product.kyobobook.co.kr/detail/S000001743852)

* [[DB] Lock에 대해서 알아보자 - 기본편](https://sabarada.tistory.com/121)